<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Ficha - Sistema Youkai</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
    <nav class="future-tabs">
        <a class="tab-button" href="../index.html">XP Avulso</a>
        <a class="tab-button active" href="char.html">Personagem</a>
        <a class="tab-button" href="#">Profissões</a>
    </nav>
</header>

<main>
    <div class="container">
        <h2>Ficha de Personagem</h2>

        <div class="status-card">
            <h3>1. Identidade</h3>
            <div class="input-group">
                <label>Nome do Personagem</label>
                <input type="text" id="charName" placeholder="Ex: Akuma-kun">
            </div>
            <div class="grid-ranks">
                <div class="input-group">
                    <label>Raça</label>
                    <select id="charRace"></select> </div>
                <div class="input-group">
                    <label>Classe</label>
                    <select id="charClass"></select> </div>
            </div>
            <div class="grid-ranks">
                <div class="input-group">
                    <label>Nível Personagem</label>
                    <input type="number" id="charLevel" value="1">
                </div>
                <div class="input-group">
                    <label>Nível Classe</label>
                    <input type="number" id="classLevel" value="1">
                </div>
            </div>
        </div>

        <div class="status-card" id="card-habilidades" style="border-left-color: var(--primary);">
            <h3>2. Habilidades de Classe</h3>
            <div id="habilidades-opcoes" class="grid-ranks" style="grid-template-columns: 1fr;">
                </div>
        </div>

        <h3>3. Atributos</h3>
        <div class="status-card" style="border-left-color: var(--primary);">
            <div class="grid-ranks">
                <div class="input-group"><label>Vida Atual</label><input type="number" id="hpAtual"></div>
                <div class="input-group"><label>Vida Máx</label><div class="fixed-val" id="hpMax">0</div></div>
            </div>
            <div class="grid-ranks">
                <div class="input-group"><label>FOR</label><input type="number" id="stat_for"></div>
                <div class="input-group"><label>DES</label><input type="number" id="stat_des"></div>
            </div>
            <div class="grid-ranks">
                <div class="input-group"><label>RM</label><input type="number" id="stat_rm"></div>
                <div class="input-group"><label>RF</label><input type="number" id="stat_rf"></div>
            </div>
            <div class="grid-ranks">
                <div class="input-group"><label>NM</label><input type="number" id="stat_nm"></div>
                <div class="input-group"><label>RC</label><input type="number" id="stat_rc"></div>
            </div>
            <div class="input-group"><label>Sanidade</label><div class="fixed-val" id="sanidade">0</div></div>
        </div>

        <h3>4. Resumo e Passivas</h3>
        <textarea id="habilidades" placeholder="Passivas automáticas aparecerão aqui..."></textarea>

        <button class="btn-calc" onclick="document.getElementById('importFile').click()">Importar .txt</button>
        <input type="file" id="importFile" style="display:none" accept=".txt">
        <button class="btn-export" onclick="exportarTxt()">Exportar Ficha</button>
        <div id="log">Aguardando interação...</div>
    </div>
</main>

<script>
const db = {
    racas: {
        "Humano": { hp: 100, san: 100, for: 2, des: 1, rm: 1, rf: 1, nm: 5, rc: 3, passiva: "Versatilidade: Começa com NM e RC altos." },
        "Youkai": { hp: 150, san: 60, for: 4, des: 4, rm: 1, rf: 1, nm: 0, rc: 0, passiva: "Demon Sanity: Buffs quando sanidade está baixa." },
        "Morto-Vivo": { hp: 70, san: 51, for: 7, des: 0, rm: 2, rf: 2, nm: 0, rc: 0, passiva: "Imortalidade: Ganha status devorando corpos." }
    },
    classes: {
        "Guerreiro": ["Investida", "Bloqueio", "Fúria"],
        "Mago": ["Seta Arcana", "Escudo Mágico", "Meditação"],
        "Ladino": ["Furtividade", "Punhalada", "Veneno"]
    }
};

// Inicializar Seletores
function init() {
    const rSel = document.getElementById('charRace');
    const cSel = document.getElementById('charClass');
    
    Object.keys(db.racas).forEach(r => rSel.add(new Option(r, r)));
    Object.keys(db.classes).forEach(c => cSel.add(new Option(c, c)));

    rSel.addEventListener('change', carregarStatusBase);
    cSel.addEventListener('change', renderHabilidades);
    
    // Qualquer mudança nos inputs numéricos atualiza o texto final
    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('change', atualizarTextoFinal);
    });

    carregarStatusBase();
}

function carregarStatusBase() {
    const raca = db.racas[document.getElementById('charRace').value];
    document.getElementById('hpMax').innerText = raca.hp;
    document.getElementById('hpAtual').value = raca.hp;
    document.getElementById('sanidade').innerText = raca.san;
    document.getElementById('stat_for').value = raca.for;
    document.getElementById('stat_des').value = raca.des;
    document.getElementById('stat_rm').value = raca.rm;
    document.getElementById('stat_rf').value = raca.rf;
    document.getElementById('stat_nm').value = raca.nm;
    document.getElementById('stat_rc').value = raca.rc;
    
    renderHabilidades();
}

function renderHabilidades() {
    const classe = document.getElementById('charClass').value;
    const container = document.getElementById('habilidades-opcoes');
    container.innerHTML = "";

    db.classes[classe].forEach(hab => {
        const div = document.createElement('div');
        div.innerHTML = `<input type="checkbox" class="hab-check" value="${hab}"> ${hab}`;
        div.querySelector('input').addEventListener('change', atualizarTextoFinal);
        container.appendChild(div);
    });
    atualizarTextoFinal();
}

function atualizarTextoFinal() {
    const racaNome = document.getElementById('charRace').value;
    const classeNome = document.getElementById('charClass').value;
    const nClasse = document.getElementById('classLevel').value;
    const selecionadas = Array.from(document.querySelectorAll('.hab-check:checked')).map(c => c.value);

    let resumo = `--- PASSIVAS (${racaNome}) ---\n${db.racas[racaNome].passiva}\n\n`;
    resumo += `--- HABILIDADES (${classeNome} Nív.${nClasse}) ---\n`;
    resumo += selecionadas.length ? selecionadas.join(' | ') : "Nenhuma selecionada.";
    
    document.getElementById('habilidades').value = resumo;
}

// Exportação/Importação mantêm a lógica anterior, mas agora salvam o ClassLevel
function exportarTxt() {
    const nome = document.getElementById('charName').value || "Ficha";
    let txt = `Nome: ${nome}\nRaça: ${document.getElementById('charRace').value}\n`;
    txt += `Classe: ${document.getElementById('charClass').value}\nNível Classe: ${document.getElementById('classLevel').value}\n`;
    txt += `FOR: ${document.getElementById('stat_for').value}\nDES: ${document.getElementById('stat_des').value}\n`;
    txt += `--- HABILIDADES ---\n${document.getElementById('habilidades').value}`;

    const blob = new Blob([txt], {type: 'text/plain'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = nome + ".txt";
    a.click();
}

window.onload = init;
</script>

</body>
</html>