<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de XP RPG</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; text-align: center ;}

    h1 { color: #4CAF50; }

    h2 { margin-top: 25px; }

    label { display: block; margin-top: 10px; }

    input, select { margin-top: 5px; padding: 5px; }

    button { margin-top: 15px; padding: 10px; background: #4CAF50; color: white; border: none; cursor: pointer; }
    
    button:hover { background: #45a049; }

    .resultado { margin-top: 20px; padding: 10px; border: 1px solid #ccc; background: #f9f9f9; }

  </style>
</head>
<body>
  <h1>Calculadora de Experi√™ncia</h1>

  <div>
      <h2>Par√¢metros iniciais</h2>
      <label for="nivelAtual">N√≠vel atual:</label>
      <input type="number" id="nivelAtual" value="1" min="1">
      
      <label for="xpAtual">XP atual:</label>
      <input type="number" id="xpAtual" value="0" min="0">
    </div>

    <div>

        <h2>Progress√£o</h2>
        <label for="inimigos">Inimigos abatidos:</label>
        <input type="number" id="inimigos" value="0" min="0">
        
        <label for="rankInimigo">Rank dos inimigos:</label>
        <select id="rankInimigo">
            <option value="D" selected>D</option>
            <option value="C">C</option>
            <option value="B">B</option>
            <option value="A">A</option>
            <option value="S">S</option>
            <option value="SS">SS</option>
        </select>
        
        <label for="rankDungeon">Rank da Dungeon:</label>
        <select id="rankDungeon">
            <option value="D" selected>D</option>
            <option value="C">C</option>
            <option value="B">B</option>
            <option value="A">A</option>
            <option value="S">S</option>
            <option value="SS">SS</option>
        </select>
        
        <label for="grupo">Qtd grupo de aventura:</label>
        <input type="number" id="grupo" value="0" min="1">
        
        <label for="mvp">MVP:</label>
        <select id="mvp">
            <option value="false">N√£o</option>
            <option value="true">Sim</option>
        </select>
        
    </div>
  <button onclick="calcularXP()">Calcular</button>

  <div class="resultado" id="resultado"></div>

  <script>
    // Tabelas e fun√ß√µes auxiliares
    const XP_INIMIGO = { D: 10, C: 45, B: 80, A: 125, S: 180, SS: 225 };
    const M_DUNGEON = { D: 1.1, C: 1.2, B: 1.3, A: 1.4, S: 1.5, SS: 2.0 };
    const M_GRUPO = { 2: 1.03, 3: 1.05, 4: 1.07, 5: 1.10, 6: 1.15, 7: 1.20, 8: 1.30 };

    function multGrupo(n) {
      if (n >= 9) return 1.50;
      if (n <= 1) return 1.0;
      return M_GRUPO[n];
    }

    // XP necess√°rio para atingir o n√≠vel n
    function xpPorNivel(n, k = 20) {
      return k * (n ** 2);
    }

    // XP acumulado at√© o n√≠vel n
    function xpTotalParaNivel(n, k = 20) {
      return Math.floor(k * (n * (n + 1) * (2 * n + 1) / 6));
    }

    // Qual n√≠vel o personagem est√° dado o XP acumulado
    function nivelAtualPorXP(xp, k = 20) {
      let nivel = 0;
      while (xpTotalParaNivel(nivel + 1, k) <= xp) {
        nivel++;
      }
      return nivel;
    }

function calcularXP() {
  const nivelInicial = parseInt(document.getElementById("nivelAtual").value);
  const xpInicial = parseInt(document.getElementById("xpAtual").value);
  const inimigos = parseInt(document.getElementById("inimigos").value);
  const rankInimigo = document.getElementById("rankInimigo").value;
  const rankDungeon = document.getElementById("rankDungeon").value;
  const grupo = parseInt(document.getElementById("grupo").value);
  const mvp = document.getElementById("mvp").value === "true";

  // XP m√°ximo permitido para o n√≠vel atual
  const xpMaxNivel = xpTotalParaNivel(nivelInicial) - 1;

  // Valida√ß√£o: XP atual n√£o pode ser maior que o limite do n√≠vel
  if (xpInicial > xpMaxNivel) {
    document.getElementById("resultado").innerHTML = `
      <span style="color:red"><strong>Erro:</strong> O XP informado (${xpInicial}) √© maior do que o permitido para o n√≠vel ${nivelInicial} (m√°ximo ${xpMaxNivel}).</span>
    `;
    return; // interrompe o c√°lculo
  }

  // XP ganho na run
  const xpBase = inimigos * XP_INIMIGO[rankInimigo];
  const md = M_DUNGEON[rankDungeon];
  const mg = multGrupo(grupo);
  const mmvp = mvp ? 2.0 : 1.0;
  const xpRun = Math.round(xpBase * md * mg * mmvp);

  // XP total acumulado
  const xpTotal = xpInicial + xpRun;

  // Determinar n√≠vel final com base no XP acumulado
  const nivelFinal = nivelAtualPorXP(xpTotal);

  // XP necess√°rio para pr√≥ximo n√≠vel
  const xpProximo = xpTotalParaNivel(nivelFinal + 1);
  const falta = xpProximo - xpTotal;

  // Verificar quantos n√≠veis foram ganhos
  const niveisGanhos = nivelFinal - nivelInicial;

  let resultadoTexto = `
    <strong>Resultados:</strong><br>
    XP ganho na run: ${xpRun}<br>
    XP total acumulado: ${xpTotal}<br>
    N√≠vel atual: ${nivelFinal +1}<br> 
    XP necess√°rio para n√≠vel ${nivelFinal + 2}: ${xpProximo}<br>
    Falta ${falta} XP para o pr√≥ximo n√≠vel.<br>
  `;

  if (niveisGanhos > 0) {
    if (niveisGanhos === 1) {
      resultadoTexto += `<span style="color:green;">üéâ Parab√©ns! Voc√™ subiu para o n√≠vel ${nivelFinal+1}!</span>`;
    } else {
      resultadoTexto += `<span style="color:orange">üî• Incr√≠vel! Voc√™ subiu ${niveisGanhos+1} n√≠veis de uma vez, agora est√° no n√≠vel ${nivelFinal}!</span>`;
    }
  }

  document.getElementById("resultado").innerHTML = resultadoTexto;
}
  </script>
</body>
</html>